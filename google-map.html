<!DOCTYPE html>
<html lang="pt-BR">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Mapa</title>
        <style>
            /*
         * Always set the map height explicitly to define the size of the div element
         * that contains the map.
         */
            #map {
                min-height: 480px;
                height: calc(100vh - 40px);
            }

            /*
         * Optional: Makes the sample page fill the window.
         */
            html,
            body {
                height: 100%;
                margin: 0;
                padding: 0;
            }
        </style>
    </head>
    <body>
        <h1>Mapa</h1>
        <div id="map"></div>
        <script>
            ((g) => {
                var h,
                    a,
                    k,
                    p = "The Google Maps JavaScript API",
                    c = "google",
                    l = "importLibrary",
                    q = "__ib__",
                    m = document,
                    b = window;
                b = b[c] || (b[c] = {});
                var d = b.maps || (b.maps = {}),
                    r = new Set(),
                    e = new URLSearchParams(),
                    u = () =>
                        h ||
                        (h = new Promise(async (f, n) => {
                            await (a = m.createElement("script"));
                            e.set("libraries", [...r] + "");
                            for (k in g)
                                e.set(
                                    k.replace(
                                        /[A-Z]/g,
                                        (t) => "_" + t[0].toLowerCase()
                                    ),
                                    g[k]
                                );
                            e.set("callback", c + ".maps." + q);
                            a.src =
                                `https://maps.${c}apis.com/maps/api/js?` + e;
                            d[q] = f;
                            a.onerror = () =>
                                (h = n(Error(p + " could not load.")));
                            a.nonce =
                                m.querySelector("script[nonce]")?.nonce || "";
                            m.head.append(a);
                        }));
                d[l]
                    ? console.warn(p + " only loads once. Ignoring:", g)
                    : (d[l] = (f, ...n) =>
                          r.add(f) && u().then(() => d[l](f, ...n)));
            })({
                key: "[API-KEY]",
                v: "weekly",
                // Use the 'v' parameter to indicate the version to use (weekly, beta, alpha, etc.).
                // Add other bootstrap parameters as needed, using camel case.
            });
        </script>
        <script>
            let map;

            async function initMap() {
                const { Map } = await google.maps.importLibrary("maps");
                // -23.626138170629496	-46.713513289553646
                map = new Map(document.getElementById("map"), {
                    center: { lat: -23.626, lng: -46.713 },
                    zoom: 11,
                });

                const statesGeoJson = {
                    type: "FeatureCollection",
                    features: [
                        {
                            type: "Feature",
                            properties: {
                                id: "3539103",
                                name: "Pirapora do Bom Jesus",
                                description: "Pirapora do Bom Jesus",
                            },
                            geometry: {
                                type: "Polygon",
                                coordinates: [
                                    [
                                        [-46.9374880651, -23.3213654587],
                                        [-46.9375757089, -23.3274557884],
                                        [-46.937582418, -23.3278638853],
                                        [-46.9404426889, -23.35178359],
                                        [-46.9342527207, -23.3638700069],
                                        [-46.9275501252, -23.3559484604],
                                        [-46.9111525738, -23.3525325112],
                                        [-46.9018453599, -23.3588432758],
                                        [-46.9018410132, -23.365625268],
                                        [-46.9198746958, -23.3762254079],
                                        [-46.9314459365, -23.3786535871],
                                        [-46.9282357987, -23.3871906042],
                                        [-46.935662183, -23.3845485519],
                                        [-46.9399085195, -23.3912999514],
                                        [-46.9493978879, -23.3919826586],
                                        [-46.955202214, -23.3977608285],
                                        [-46.9433237015, -23.4013599646],
                                        [-46.9531157972, -23.4107809311],
                                        [-46.9643911075, -23.4109143183],
                                        [-46.9668993001, -23.4183717883],
                                        [-46.97031697, -23.4248297819],
                                        [-46.9856728312, -23.433293842],
                                        [-46.9955040924, -23.4289465498],
                                        [-47.0372199452, -23.4355561028],
                                        [-47.0346569162, -23.4313162197],
                                        [-47.0410646823, -23.4179262584],
                                        [-47.0356669126, -23.398596807],
                                        [-47.0421686296, -23.3862590625],
                                        [-47.0371068972, -23.3814946654],
                                        [-47.0285577438, -23.375008019],
                                        [-47.030145082, -23.3712621544],
                                        [-47.0382905326, -23.3685324567],
                                        [-47.0424580614, -23.3517735664],
                                        [-47.0307902352, -23.3455250425],
                                        [-47.0168733886, -23.3448698077],
                                        [-47.0148955391, -23.339845742],
                                        [-47.0076375612, -23.3370487736],
                                        [-47.0000880845, -23.3376539615],
                                        [-46.9995412407, -23.3327581113],
                                        [-46.9952630993, -23.3305126064],
                                        [-46.9832109971, -23.3331535186],
                                        [-46.9635781811, -23.3230867624],
                                        [-46.9586532682, -23.326342136],
                                        [-46.9448792545, -23.3246750742],
                                        [-46.9409917664, -23.3197744708],
                                        [-46.9374880651, -23.3213654587],
                                    ],
                                ],
                            },
                        },
                        {
                            type: "Feature",
                            properties: {
                                id: "3547304",
                                name: "Santana de Parnaíba",
                                description: "Santana de Parnaíba",
                            },
                            geometry: {
                                type: "Polygon",
                                coordinates: [
                                    [
                                        [-46.9282357987, -23.3871906042],
                                        [-46.9181968425, -23.3896526343],
                                        [-46.9131200979, -23.3862182411],
                                        [-46.9128787303, -23.3912453703],
                                        [-46.9008653028, -23.3995065673],
                                        [-46.8860221565, -23.3988876692],
                                        [-46.8843136849, -23.3946796978],
                                        [-46.8806998709, -23.3956756315],
                                        [-46.8705641024, -23.4004318856],
                                        [-46.8669810117, -23.4047259192],
                                        [-46.8687055678, -23.4148454077],
                                        [-46.8629106006, -23.4187442621],
                                        [-46.8411534918, -23.4209588799],
                                        [-46.8316607421, -23.4298877789],
                                        [-46.8225052673, -23.4212540084],
                                        [-46.8097722277, -23.4416048019],
                                        [-46.8093417687, -23.4427453888],
                                        [-46.8075416112, -23.4530472382],
                                        [-46.800427978, -23.4701684932],
                                        [-46.8074376727, -23.4841505327],
                                        [-46.8140051797, -23.4859577458],
                                        [-46.8205459751, -23.4804782458],
                                        [-46.8333757764, -23.4837953786],
                                        [-46.8479774779, -23.4804915667],
                                        [-46.852021338, -23.4834412947],
                                        [-46.8654611683, -23.4806423284],
                                        [-46.8682423172, -23.4771852495],
                                        [-46.8761901992, -23.4794093008],
                                        [-46.879449441, -23.4708622468],
                                        [-46.8851743049, -23.4716699366],
                                        [-46.8886632282, -23.4833283894],
                                        [-46.8958262319, -23.4849052144],
                                        [-46.8973401001, -23.4897916805],
                                        [-46.9119515354, -23.4906435554],
                                        [-46.9146155339, -23.4875062078],
                                        [-46.9433763005, -23.4872883555],
                                        [-46.9529323262, -23.4833823975],
                                        [-46.9566020595, -23.4873245288],
                                        [-46.954755413, -23.4900243486],
                                        [-46.9632969168, -23.4941287379],
                                        [-46.9643502449, -23.49848955],
                                        [-46.979797987, -23.5045120761],
                                        [-46.9843794337, -23.5032261549],
                                        [-46.9885650099, -23.507649072],
                                        [-46.9945107124, -23.5066817394],
                                        [-47.00191545, -23.5027681757],
                                        [-47.0129631713, -23.4849738725],
                                        [-47.0178309668, -23.4835710843],
                                        [-47.0132909318, -23.4776903855],
                                        [-47.016680578, -23.4736380701],
                                        [-47.0113661684, -23.4647107939],
                                        [-47.0136890524, -23.4576796875],
                                        [-47.0101403239, -23.4548382886],
                                        [-47.010175656, -23.4458511508],
                                        [-47.0237044249, -23.4408770867],
                                        [-47.0294029957, -23.4423942568],
                                        [-47.0372199452, -23.4355561028],
                                        [-46.9955040924, -23.4289465498],
                                        [-46.9856728312, -23.433293842],
                                        [-46.97031697, -23.4248297819],
                                        [-46.9668993001, -23.4183717883],
                                        [-46.9643911075, -23.4109143183],
                                        [-46.9531157972, -23.4107809311],
                                        [-46.9433237015, -23.4013599646],
                                        [-46.955202214, -23.3977608285],
                                        [-46.9493978879, -23.3919826586],
                                        [-46.9399085195, -23.3912999514],
                                        [-46.935662183, -23.3845485519],
                                        [-46.9282357987, -23.3871906042],
                                    ],
                                ],
                            },
                        },
                    ],
                };

                map.data.addGeoJson(statesGeoJson);

                // Create empty bounds object
                var bounds = new google.maps.LatLngBounds();

                // Loop through features
                map.data.forEach(function (feature) {
                    var geo = feature.getGeometry();

                    geo.forEachLatLng(function (LatLng) {
                        bounds.extend(LatLng);
                    });
                });

                map.fitBounds(bounds);

                // map data styles
                map.data.setStyle({
                    strokeColor: '#FF0000',
                    strokeOpacity: 0.8,
                    strokeWeight: 2,
                    fillColor: '#FF0000',
                    fillOpacity: 0.35
                });

                const localPoints = [
                    {
                        position: new google.maps.LatLng(-23.504671432841672, -46.8799067213287),
                        type: "excelente",
                        color: "green",
                        city: "Barueri",
                        bank: "Banco Pantander",
                        detail: "Visitado em 23/09/2023"
                    },
                    {
                        position: new google.maps.LatLng(-23.53264133134739, -46.77393829105304),
                        type: "regular",
                        color: "blue",
                        city: "Osasco",
                        bank: "Banco Iraú",
                        detail: "Visitado em 22/09/2023"
                    },
                    {
                        position: new google.maps.LatLng(-23.626138170629496, -46.713513289553646),
                        type: "ruim",
                        color: "red",
                        city: "São Paulo",
                        bank: "Banco do Blasil",
                        detail: "Visitado em 21/09/2023"
                    },
                ];

                // Create markers.
                for (let i = 0; i < localPoints.length; i++) {
                    const marker = new google.maps.Marker({
                        position: localPoints[i].position,
                        // icon: icons[localPoints[i].type].icon,
                        icon: {
                            url: "https://maps.google.com/mapfiles/ms/icons/" + localPoints[i].color + ".png"
                        },
                        title: localPoints[i].bank,
                        map: map,
                    });

                    const contentString =
                        `<div class="info">
                            <h3>${localPoints[i].bank}</h3>
                            <p>${localPoints[i].city}</p>
                            <p>Avaliado como ${localPoints[i].type}</p>
                            <p>${localPoints[i].detail}</p>
                        </div>`;

                    const infowindow = new google.maps.InfoWindow({
                        content: contentString,
                    });

                    // marker.addListener('mouseover', () => {
                    //     infowindow.open({anchor: marker, map});
                    // });

                    // // assuming you also want to hide the infowindow when user mouses-out
                    // let handleMouseout = marker.addListener('mouseout', () => {
                    //     infowindow.close();
                    // });

                    marker.addListener('click', () => {
                        infowindow.open({anchor: marker, map});

                        // google.maps.event.removeListener(handleMouseout);

                        // infowindow.addListener('closeclick', () => {
                        //     // Handle focus manually.
                        //     handleMouseout = marker.addListener('mouseout', () => {
                        //         infowindow.close();
                        //     });
                        // });
                    });
                }
            }

            initMap();
        </script>
    </body>
</html>
